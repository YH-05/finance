---
description: 自然言語の要件から実装計画書を作成し、GitHub Project を新規作成します。
argument-hint: "<要件の説明>" [--name <計画書名>]
---

要件から実装計画書を作成し、GitHub Project を新規作成します。

## 入力パラメータの解析

ユーザーが指定したパラメータを確認します：

- **要件の説明** (必須): 実装したい内容の自然言語説明
  - 例: `"リサーチフェーズに YouTube 動画検索を追加したい"`
- **--name** (任意): 計画書名を明示的に指定
  - 省略時: 要件から自動生成

### パラメータ検証

```
if 要件の説明が指定されていない:
    エラー [E001] を表示:

    ❌ エラー [E001]: 必須パラメータが不足しています

    不足パラメータ: 要件の説明

    💡 対処法:
    - /new-plan "要件の説明" の形式で実行してください
    - 例: /new-plan "リサーチフェーズに YouTube 動画検索を追加したい"

    処理を中断
```

## 実行手順

### Step 1: GitHub 認証確認

```bash
gh auth status
```

**認証済みの場合**: Step 2 に進む

**未認証の場合**:

```
⚠️ GitHub 認証が必要です

以下のコマンドで認証を行ってください:
  gh auth login

認証完了後、再度 /new-plan を実行してください。
```

処理を中断

### Step 2: 計画書名の決定

**--name が指定されている場合**: その名前を使用

**--name が指定されていない場合**: 要件から計画書名を生成

命名ルール:
- 英語のケバブケース（小文字、ハイフン区切り）
- 30文字以内
- 日付は含めない

例:
- "YouTube 動画検索を追加" → `youtube-search`
- "エージェントのエラーハンドリング改善" → `agent-error-handling`
- "新しいカテゴリの追加" → `new-category`

### Step 3: 要件の分析

要件を分析し、以下の情報を抽出します：

**分析項目**:

1. **目的**: 何を達成したいか
2. **背景**: なぜ必要か
3. **スコープ**: 何を含み、何を含まないか
4. **成果物**: 何が出力されるか
5. **依存関係**: 何に依存するか
6. **リスク**: 想定される問題

**分析にはコードベースの調査が必要**:

- 関連する既存のエージェント・コマンドを検索
- 類似の実装パターンを確認
- 影響を受けるファイルを特定

### Step 4: 計画書の生成

以下のテンプレートに従って計画書を生成します。

**出力先**: `docs/project/{plan-name}.md`

```markdown
# {計画書タイトル}

**作成日**: {今日の日付}
**ステータス**: 計画中
**GitHub Project**: {project_name}

## 背景と目的

### 背景

{なぜこの機能が必要か}

### 目的

{何を達成したいか}

## スコープ

### 含むもの

- {スコープ内の項目1}
- {スコープ内の項目2}

### 含まないもの

- {スコープ外の項目1}

## 成果物

| 種類 | 名前 | 説明 |
| ---- | ---- | ---- |
| {種類} | {名前} | {説明} |

## 実装方針

### アーキテクチャ

{全体的な実装方針}

### 技術的な考慮事項

- {考慮事項1}
- {考慮事項2}

## タスク一覧

### {カテゴリ1}

- [ ] {タスク1}
- [ ] {タスク2}

### {カテゴリ2}

- [ ] {タスク3}
- [ ] {タスク4}

## リスクと対策

| リスク | 影響度 | 対策 |
| ---- | ---- | ---- |
| {リスク} | {高/中/低} | {対策} |

## 次のステップ

1. /polish-plan でこの計画書をレビュー
2. /make-task でタスクを GitHub に登録
3. 実装開始

---

**最終更新**: {今日の日付}
```

### Step 5: 計画書の保存

計画書を `docs/project/{plan-name}.md` に保存します。

### Step 6: GitHub Project の作成

GitHub Project を新規作成します。

```bash
gh project create --title "{plan-name}" --owner @me
```

**成功した場合**: Step 7 に進む

**失敗した場合**:

```
⚠️ GitHub Project の作成に失敗しました

エラー: {エラーメッセージ}

計画書は作成されています: docs/project/{plan-name}.md

対処法:
1. 手動で Project を作成:
   gh project create --title "{plan-name}" --owner @me
2. /make-task で Issue を登録する際に Project を指定
```

### Step 7: 完了レポート

```
✅ 計画書を作成しました

📄 計画書:
- パス: docs/project/{plan-name}.md
- タイトル: {計画書タイトル}

🗂️ GitHub Project:
- 名前: {plan-name}
- URL: {project_url}

📝 次のステップ:
1. 計画書の内容を確認してください
2. /polish-plan docs/project/{plan-name}.md で計画を精査
3. /make-task docs/project/{plan-name}.md でタスクを GitHub に登録
```

## コードベース調査のガイド

計画書を作成する際、以下の調査を行います：

### 関連ファイルの検索

```
Glob: .claude/agents/*.md
Glob: .claude/commands/*.md
Glob: data/schemas/*.json
```

### 類似パターンの確認

要件に関連する既存の実装を確認し、パターンを参考にします。

### 影響範囲の特定

変更が影響を与える可能性のあるファイルを特定します。

## エラーハンドリング

### E001: パラメータエラー

必須パラメータが不足している場合。

### E002: ファイル書き込みエラー

計画書の保存に失敗した場合。

### E003: 認証エラー

GitHub 認証が必要な場合。

### E004: Project 作成エラー

GitHub Project の作成に失敗した場合。計画書は保存済みなので、手動で Project を作成する方法を案内。

## 使用例

**基本的な使用**:

```
/new-plan "リサーチフェーズに YouTube 動画検索を追加したい"
```

**計画書名を指定**:

```
/new-plan "エージェントのエラー処理を改善" --name agent-error-handling
```

## 計画書作成後のフロー

```
/new-plan "要件"
    ↓
計画書が docs/project/ に生成
    ↓
GitHub Project が作成
    ↓
/polish-plan <計画書> でレビュー・改善
    ↓
/make-task <計画書> でタスクを GitHub に登録
    ↓
実装開始
```
