# dry-run モードパターン

GitHub への投稿を行わずに、収集結果を事前確認するパターンです。

## 使用場面

- **初回セットアップ時**: 設定が正しいか確認
- **新しいフィードを追加した後**: 記事が正しく取得されるか確認
- **パラメータ調整時**: 期間や件数の調整結果を確認
- **デバッグ時**: 問題の切り分け

## 基本的な使用方法

### dry-run モードで実行

```bash
/collect-finance-news --dry-run
```

### 期待される出力

```
================================================================================
                    /collect-finance-news 開始 [DRY-RUN]
================================================================================

## Phase 1: 初期化
- テーマ設定: data/config/finance-news-themes.json ✓
- RSS MCP: ツール確認完了 ✓
- GitHub CLI: 認証済み ✓
- モード: DRY-RUN（投稿はスキップされます）

## Phase 2: データ準備
- RSS記事取得: 42件
- 既存Issue取得: 15件（重複チェック用）
- 一時ファイル保存: .tmp/news-collection-20260122T0900.json

## Phase 3: テーマ別収集（DRY-RUN）

### Index（株価指数）
投稿予定: 6件

| # | タイトル | 公開日時 | ステータス |
|---|---------|---------|-----------|
| 1 | 日経平均、3万8000円台回復 | 2026-01-22 08:30 | 新規 |
| 2 | TOPIX続伸、銀行株に買い | 2026-01-22 07:45 | 新規 |
| 3 | S&P500、最高値更新 | 2026-01-22 06:00 | 新規 |
| ... | ... | ... | ... |

スキップ予定（重複）: 2件
- "日経平均、円安で上昇" (既存: #345)
- "NYダウ上昇" (既存: #342)

### Stock（個別銘柄）
投稿予定: 10件
スキップ予定（重複）: 2件

### Sector（業界動向）
投稿予定: 4件
スキップ予定（重複）: 1件

### Macro Economics（マクロ経済）
投稿予定: 8件
スキップ予定（重複）: 2件

### AI
投稿予定: 4件
スキップ予定（重複）: 0件

### Finance（企業財務）
投稿予定: 3件
スキップ予定（重複）: 0件

## Phase 4: 結果サマリー [DRY-RUN]

| テーマ | 投稿予定 | 重複スキップ |
|--------|---------|-------------|
| Index | 6 | 2 |
| Stock | 10 | 2 |
| Sector | 4 | 1 |
| Macro Economics | 8 | 2 |
| AI | 4 | 0 |
| Finance | 3 | 0 |
| **合計** | **35** | **7** |

⚠️ DRY-RUN モード: 上記は投稿されていません
本番実行するには --dry-run を外して再実行してください:

    /collect-finance-news

================================================================================
                    /collect-finance-news 完了 [DRY-RUN]
================================================================================
```

## 出力内容の解説

### 1. 投稿予定件数

各テーマで GitHub Project に投稿される予定の件数が表示されます。

### 2. 重複チェック結果

既存の Issue と重複する記事がリストアップされます。これらは本番実行時もスキップされます。

### 3. 記事プレビュー

各テーマの最初の数件の記事タイトルと公開日時が表示されます。

## 組み合わせパターン

### テーマフィルタリングと組み合わせ

```bash
# 特定テーマの結果を事前確認
/collect-finance-news --themes "macro,index" --dry-run
```

### 期間指定と組み合わせ

```bash
# 1週間分の結果を事前確認
/collect-finance-news --since 7d --dry-run
```

### すべてのオプションを組み合わせ

```bash
# 複合条件での事前確認
/collect-finance-news --since 3d --themes "stock,ai" --limit 30 --dry-run
```

## 本番実行前の確認手順

### 推奨フロー

```
1. dry-run で確認
   /collect-finance-news --dry-run

2. 結果を確認
   - 投稿予定件数が適切か
   - 重複チェックが正しく動作しているか
   - 期待するテーマの記事が取得されているか

3. 問題なければ本番実行
   /collect-finance-news
```

### 確認ポイント

| チェック項目 | 確認方法 |
|-------------|---------|
| 記事が取得できている | 「投稿予定」が 0 件でないこと |
| 重複チェックが機能 | 既存 Issue と同じ記事がスキップされていること |
| テーマ分類が正確 | 各テーマに適切な記事が分類されていること |
| 期間フィルタが有効 | 指定期間外の記事が含まれていないこと |

## トラブルシューティング

### 記事が0件の場合

```bash
# 期間を広げて再確認
/collect-finance-news --since 7d --dry-run
```

それでも0件の場合：
1. RSS フィードが正常か確認
2. テーマ設定ファイルのフィード設定を確認

### 重複が多すぎる場合

直近の収集が完了している可能性があります。期間を短くして確認：

```bash
/collect-finance-news --since 6h --dry-run
```

### 特定テーマだけ0件の場合

```bash
# テーマ設定を確認
cat data/config/finance-news-themes.json | jq '.themes.<テーマ名>.feeds'
```

フィードが正しく設定されているか確認してください。

## 関連パターン

- [日次収集パターン](./daily-collection.md): 全テーマの標準収集
- [テーマフィルタリングパターン](./theme-filtering.md): 特定テーマのみ収集
