---
name: weekly-comment-generation
description: "週次レポートの各セクション向けコメント文を生成するスキル。集約データとニュースを参照し、ハイブリッド方式（テンプレート＋LLM生成）で3000字以上のコメントを作成する。"
allowed-tools: Read
---

# Weekly Comment Generation

週次レポートの各セクション向けコメント文を生成するスキルです。

## 目的

このスキルは以下を提供します：

- **セクション別コメント生成**: 指数、MAG7、セクター、マクロ経済等のコメント
- **ハイブリッド方式**: テンプレート構造＋LLM生成の組み合わせ
- **文字数管理**: 各セクションの目標文字数を達成
- **ニュース統合**: 関連ニュースをコメントに組み込み

## いつ使用するか

### プロアクティブ使用

`weekly-report-writer` エージェントの第2フェーズとして、`weekly-data-aggregation` の後に呼び出される。

### 明示的な使用

週次レポート生成ワークフローの一部として呼び出し。

## 文字数目標

| セクション | 目標文字数 | 説明 |
|-----------|-----------|------|
| ハイライト | 200字 | 今週の要点を3-5ポイントで |
| 指数コメント | 500字 | 主要指数の動向と要因分析 |
| MAG7コメント | 800字 | 個別銘柄の動向とニュース |
| 上位セクターコメント | 400字 | 上位3セクターの分析 |
| 下位セクターコメント | 400字 | 下位3セクターの分析 |
| マクロ経済コメント | 400字 | Fed、経済指標の動向 |
| 投資テーマコメント | 300字 | AI、半導体等のテーマ |
| 来週の材料 | 200字 | 決算、経済指標発表 |
| **合計** | **3200字以上** | |

## 入力データ

### aggregated_data.json

`weekly-data-aggregation` スキルの出力を使用。

```json
{
  "metadata": { ... },
  "indices": {
    "primary": { ... },
    "style_analysis": { ... }
  },
  "mag7": {
    "stocks": [...],
    "top_performer": { ... },
    "bottom_performer": { ... }
  },
  "sectors": {
    "top_3": [...],
    "bottom_3": [...],
    "rotation_signal": "..."
  },
  "news": {
    "by_category": { ... },
    "highlights": [...]
  }
}
```

## 出力データ

### comments.json

```json
{
  "metadata": {
    "generated_at": "2026-01-22T09:30:00+09:00",
    "total_characters": 3450,
    "target_characters": 3200,
    "sections_complete": true
  },
  "comments": {
    "highlight": {
      "content": "- S&P 500が週間+2.50%上昇...",
      "characters": 220,
      "target": 200
    },
    "indices": {
      "content": "今週の米国株式市場は、主要3指数がすべて上昇...",
      "characters": 520,
      "target": 500
    },
    "mag7": {
      "content": "Magnificent 7銘柄は今週も市場を牽引...",
      "characters": 850,
      "target": 800
    },
    "sectors_top": {
      "content": "セクター別では、ITセクターが+2.80%で首位...",
      "characters": 420,
      "target": 400
    },
    "sectors_bottom": {
      "content": "一方、下位セクターではヘルスケアが-2.90%...",
      "characters": 410,
      "target": 400
    },
    "macro": {
      "content": "マクロ経済面では、Fed議長が...",
      "characters": 430,
      "target": 400
    },
    "themes": {
      "content": "投資テーマでは、AI半導体関連が引き続き注目...",
      "characters": 320,
      "target": 300
    },
    "outlook": {
      "content": "来週の注目材料は...",
      "characters": 210,
      "target": 200
    }
  }
}
```

## コメント生成テンプレート

### ハイライト（200字）

```markdown
テンプレート構造:
- [指数動向の要点]
- [セクター/スタイルの特徴]
- [個別銘柄の注目点]
- [マクロ要因]
- [来週の展望]

生成例:
- S&P 500が週間+2.50%上昇、年初来高値を更新
- テクノロジーセクターがグロース株をけん引
- TSLAが+3.70%で週間MAG7トップパフォーマー
- Fed議長発言で利下げ期待がやや後退
- 来週から決算シーズン本格化
```

### 指数コメント（500字）

```markdown
テンプレート構造:
1. 週間サマリー（1文）
2. 主要指数の動向（2-3文）
3. スタイル分析（2文）
   - グロース vs バリュー
   - 大型 vs 中小型
4. 要因分析（2-3文）
5. テクニカル観点（1文、任意）

生成時の参照データ:
- indices.primary（SPX, RSP, VUG, VTV）
- indices.style_analysis
- news.by_category.indices

生成例:
今週の米国株式市場は、主要3指数がすべて上昇し、S&P 500は週間+2.50%で
年初来高値を更新した。NASDAQ総合は+3.10%と大幅上昇し、テクノロジー株の
強さを反映した。ダウ工業株30種は+1.80%と堅調。

スタイル別では、グロース株（VUG: +3.20%）がバリュー株（VTV: +1.20%）を
2ポイント上回り、AI関連銘柄への資金流入が継続した。時価総額別では、
S&P 500が等ウェイト指数（RSP: +1.80%）を0.70ポイント上回り、大型株優位
の展開となった。

上昇の背景には、予想を上回る企業決算と、Fed議長の慎重ながらも前向きな
インフレ見通しがある。ただし、来週以降の決算発表集中を前に、上値の重さも
意識される展開となりそうだ。
```

### MAG7コメント（800字）

```markdown
テンプレート構造:
1. 週間サマリー（2文）
2. トップパフォーマー詳細（3-4文）
3. ボトムパフォーマー詳細（2-3文）
4. 個別銘柄ニュース（セクション形式）
5. 来週の注目点（1-2文）

生成時の参照データ:
- mag7.stocks
- mag7.top_performer
- mag7.bottom_performer
- news.by_category.mag7

生成例:
Magnificent 7銘柄は今週も市場を牽引し、7銘柄の平均週間リターンは+1.45%と
なった。特にテスラ（TSLA）が+3.70%で首位を獲得し、エヌビディア（NVDA）も
+1.90%と堅調だった。

TSLAの上昇は、中国でのモデルYの販売好調と、自動運転技術に関するポジティブな
報道が追い風となった。同社は来週決算発表を控えており、AI投資の進捗と納車
台数見通しが注目される。

一方、メタ・プラットフォームズ（META）は-1.20%と冴えない展開。広告収入の
成長鈍化懸念と、メタバース事業への投資継続に対する市場の不安が重しとなった。
アルファベット（GOOGL）も-0.80%と軟調。AI検索をめぐるマイクロソフトとの
競争激化が意識された。

#### 個別銘柄トピック

**NVDA（エヌビディア）**: 週間+1.90%
AI需要の持続性について経営陣が強気の見通しを示したことが好感された。データ
センター向けGPUの受注残は引き続き堅調。

**AAPL（アップル）**: 週間+1.50%
新型iPhoneの販売が好調との観測。ただし、中国市場での競争激化が懸念材料。

来週はTSLA、MSFTの決算発表があり、MAG7銘柄の業績動向が市場全体のセンチ
メントを左右する可能性がある。
```

### セクターコメント（上位400字、下位400字）

```markdown
テンプレート構造（上位）:
1. 上位3セクター紹介（1文）
2. 首位セクター詳細（3-4文）
3. 2位セクター（2文）
4. 3位セクター（2文）
5. ローテーション示唆（1文）

テンプレート構造（下位）:
1. 下位3セクター紹介（1文）
2. 最下位セクター詳細（3-4文）
3. 2番目に弱いセクター（2文）
4. 3番目に弱いセクター（2文）
5. リスク/機会の示唆（1文）

生成時の参照データ:
- sectors.top_3
- sectors.bottom_3
- sectors.rotation_signal
- news.by_category.sectors
```

### マクロ経済コメント（400字）

```markdown
テンプレート構造:
1. 週間の主要イベント（1-2文）
2. Fed/金利動向（2-3文）
3. 経済指標（2文）
4. 市場への影響（1-2文）

生成時の参照データ:
- news.by_category.macro
- 外部経済指標（必要に応じて）
```

### 投資テーマコメント（300字）

```markdown
テンプレート構造:
1. 注目テーマ紹介（1文）
2. AI/半導体動向（2-3文）
3. その他テーマ（1-2文）
4. 投資示唆（1文）

生成時の参照データ:
- news.by_category.tech
- mag7関連ニュース
```

### 来週の材料（200字）

```markdown
テンプレート構造:
1. 決算発表予定（1-2文）
2. 経済指標発表（1-2文）
3. イベント/その他（1文）

生成時の参照データ:
- 決算カレンダー（外部参照）
- 経済指標カレンダー（外部参照）
```

## プロセス

```
Phase 1: データ読み込み
├── aggregated_data.json を読み込み
├── 各セクションの参照データを特定
└── ニュースを関連セクションにマッピング

Phase 2: コメント生成（セクション順）
├── ハイライト生成
│   └── テンプレート + データ埋め込み
├── 指数コメント生成
│   └── テンプレート + LLM補完
├── MAG7コメント生成
│   └── テンプレート + LLM補完 + ニュース統合
├── セクターコメント生成（上位・下位）
│   └── テンプレート + LLM補完
├── マクロ経済コメント生成
│   └── ニュース要約 + LLM補完
├── 投資テーマコメント生成
│   └── ニュース要約 + LLM補完
└── 来週の材料生成
    └── カレンダー参照 + 整形

Phase 3: 文字数調整
├── 各セクションの文字数を計測
├── 目標に対する過不足を確認
├── 必要に応じて調整
└── 合計文字数を検証

Phase 4: 出力
└── comments.json を生成
```

## 品質基準

### 必須（MUST）

- [ ] 全セクションのコメントを生成
- [ ] 合計3000字以上を達成
- [ ] データに基づいた正確な記述
- [ ] 投資助言と誤解されない表現

### 推奨（SHOULD）

- 各セクションが目標文字数の±20%以内
- ニュースの適切な引用・要約
- 専門用語の適切な使用
- 読みやすい文章構成

## 使用例

### 例1: 標準的なコメント生成

**入力**: aggregated_data.json（完全なデータ）

**出力**:
```json
{
  "metadata": {
    "total_characters": 3450,
    "target_characters": 3200,
    "sections_complete": true
  },
  "comments": {
    "highlight": { "characters": 220 },
    "indices": { "characters": 520 },
    "mag7": { "characters": 850 },
    ...
  }
}
```

### 例2: データ不足時

**入力**: aggregated_data.json（ニュースデータ欠損）

**出力**:
```json
{
  "metadata": {
    "total_characters": 2800,
    "target_characters": 3200,
    "sections_complete": true,
    "warnings": ["ニュースデータが不足しているため、一部コメントが簡略化されています"]
  }
}
```

## エラーハンドリング

### E001: 入力データ不足

```json
{
  "error": "aggregated_data.json が見つかりません",
  "suggestion": "先に weekly-data-aggregation を実行してください"
}
```

### E002: 文字数目標未達

```json
{
  "warning": "合計文字数が目標に達していません",
  "actual": 2500,
  "target": 3000,
  "suggestion": "ニュースデータを追加するか、コメントを拡充してください"
}
```

## 完了条件

- [ ] 全8セクションのコメントが生成される
- [ ] 合計文字数が3000字以上
- [ ] データに基づいた正確な内容
- [ ] comments.json が出力される

## 関連スキル

- **weekly-data-aggregation**: 入力データを提供
- **weekly-template-rendering**: 生成したコメントをテンプレートに埋め込み
- **weekly-report-validation**: コメント品質の検証

## 参考資料

- `docs/project/project-21/project.md`: 週次レポートプロジェクト計画
- `.claude/templates/weekly-report-issue.md`: Issue投稿テンプレート
