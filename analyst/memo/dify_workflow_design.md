# Difyワークフロー詳細設計書

> 作成日: 2026-02-13
> 前提: [設計議論サマリー](discussion_summary.md)、[Dify設計議論](dify_design_discussion.md)
> 上位文書: [CAGR推定フレームワーク](cagr_estimation_framework.md)

---

## 1. 概要

本文書は、KYの投資判断を模倣するDifyワークフローの詳細設計書である。

### 目的

アナリストレポートと10-K/10-Qを入力として、KYの12ルール＋補足に基づく競争優位性評価レポートを生成する。

### 設計原則

| 原則 | 内容 |
|------|------|
| KYの暗黙知のみ注入 | 外部フレームワーク（Seven Powers等）は導入しない |
| 主張は破棄しない | ファクトチェック失敗でもアノテーション付きで保持 |
| RAG依存 + 一覧表緩和 | 将来のテキスト量増大に備え、詳細はRAGに委ねる |
| 分類軸はフィードバックの出力 | descriptive_labelで開始し、KY固有の分類軸は蓄積後に導入 |

---

## 2. ナレッジベース設計

### 2.1 KB一覧

| KB | 名称 | 内容 | チャンク数 | チャンク単位 |
|----|------|------|-----------|-------------|
| KB1 | ルール集 | KYの12ルール完全版（定義＋具体例＋補足） | 8 | ルール単位 |
| KB2 | パターン集 | 却下パターンA〜G ＋ 高評価パターンI〜V | 12 | パターン単位 |
| KB3 | few-shot集 | KY評価付き銘柄例（ORLY, COST, MNST, CHD, LLY） | 5 | 銘柄単位 |
| KB4 | 10-K/10-Q | 法定開示テキスト（銘柄ごとに作成） | 可変 | セクション単位 |

### 2.2 KB1: ルール集（8チャンク）

各チャンクは「ルール定義＋具体例＋補足」を1つにまとめる（判断1）。

| チャンク | ルール | カテゴリ | 内容 |
|---------|--------|---------|------|
| 1 | ルール1 | 優位性の定義 | 能力・仕組み ≠ 結果・実績 ＋ ブランド力4類型補足 |
| 2 | ルール2 | 優位性の定義 | 名詞で表現される属性 |
| 3 | ルール6 | 優位性の定義 | 構造的 vs 補完的を区別 |
| 4 | ルール8 | 優位性の定義 | 戦略 ≠ 優位性 |
| 5 | ルール4 | 裏付けの質 | 定量的裏付け |
| 6 | ルール7 | 裏付けの質 | 純粋競合への差別化 |
| 7 | ルール10 | 裏付けの質 | ネガティブケース（断念例） |
| 8 | ルール11 | 裏付けの質 | 業界構造×企業ポジション合致 |

**注**: ゲートキーパー（ルール9, 3）とCAGR接続（ルール5＋確度統合補足, 12）はシステムプロンプトに常時注入するため、KB1には含めない。

### 2.3 KB2: パターン集（12チャンク）

| チャンク | パターン | 種別 | 概要 |
|---------|---------|------|------|
| 1 | A | 却下 | 結果を原因と取り違え |
| 2 | B | 却下 | 業界共通で差別化にならない |
| 3 | C | 却下 | 因果関係の飛躍 |
| 4 | D | 却下 | 定性的で定量的裏付けなし |
| 5 | E | 却下 | 事実誤認 |
| 6 | F | 却下 | 戦略を優位性と混同 |
| 7 | G | 却下 | 純粋競合に対する優位性不明 |
| 8 | I | 高評価 | 定量的裏付けのある差別化 |
| 9 | II | 高評価 | 直接的なCAGR接続メカニズム |
| 10 | III | 高評価 | 能力 > 結果（プロセスの評価） |
| 11 | IV | 高評価 | 構造的な市場ポジション |
| 12 | V | 高評価 | 競合との具体的比較 |

各チャンクには確信度の目安・具体例（銘柄名＋主張番号）を含める。

### 2.4 KB3: few-shot集（5チャンク）

銘柄単位で構造化（判断2）。各チャンクに含める情報:

```
銘柄名: ORLY
主張一覧:
  #1: [主張内容] — KY評価: 70%（理由: ...）
  #2: [主張内容] — KY評価: 90%（理由: ...）
  ...
全体所見: KYが重視した視点、最高評価/最低評価の理由
```

| チャンク | 銘柄 | 平均優位性スコア | 特徴 |
|---------|------|----------------|------|
| 1 | ORLY | 63% | 市場構造との合致が最高評価要因 |
| 2 | COST | 39% | 分散大。一般論を厳しく却下 |
| 3 | MNST | 40% | シェア=結果の原則を厳格適用 |
| 4 | CHD | 50% | 能力vs結果の区別が明確 |
| 5 | LLY | 47% | 業界共通能力を厳しく批判 |

### 2.5 KB4: 10-K/10-Q（銘柄ごと）

PoC対象銘柄ごとに作成。10-K全文（10万トークン超）をセクション単位でチャンク分割。

主要セクション:
- Item 1: Business（事業概要）
- Item 1A: Risk Factors（リスク要因）
- Item 2: Properties（資産）
- Item 7: MD&A（経営者による財務分析）
- Item 8: Financial Statements（財務諸表）

---

## 3. システムプロンプト設計

### 3.1 常時注入部分（全LLMノード共通）

```
## あなたの役割

あなたはアナリストKYの投資判断を再現するAIです。
以下のルールとナレッジベースの情報に基づき、競争優位性とCAGR接続を評価してください。

---

## ゲートキーパー（違反時は即低評価）

### ルール9: 事実誤認は即却下
財務指標やデータの誤認が含まれる主張は確信度10%とする。
例: MNST#6 — OPMをGPMと誤認 → 即却下

### ルール3: 相対的優位性を要求
「誰でも持っている」能力は競争優位性ではない。
同業態の純粋競合と比較して相対的に優位である必要がある。
例: LLY#6 — グローバル医療機関ネットワーク = メガファーマ共通 → 30%

---

## CAGR接続の評価（優位性とは独立した第2軸）

### ルール5: 直接的メカニズム + 検証可能性
1-2ステップの因果で、開示データで検証可能なCAGR接続を高評価する。
3段階以上の因果チェーンや数値根拠不明は低評価。
  └ CAGRパラメータの表現:
    寄与幅と達成確度は統合して反映する。
    競争優位性の強度が高ければ寄与幅・確度とも高くなり、弱ければ両方下がる。

### ルール12: ①主②従の階層
期初レポートの前提を再検証する姿勢を高評価。
四半期レビューの積み重ねから拡大解釈する姿勢を低評価。

---

## ルール一覧（詳細はナレッジベースを参照）

以下のルールが存在する。評価時は必ずナレッジベースを参照し、該当ルールの具体例を確認すること。

| # | ルール | カテゴリ |
|---|--------|---------|
| 1 | 能力・仕組み ≠ 結果・実績 | 優位性の定義 |
| 2 | 名詞で表現される属性 | 優位性の定義 |
| 4 | 定量的裏付け | 裏付けの質 |
| 6 | 構造的 vs 補完的を区別 | 優位性の定義 |
| 7 | 純粋競合への差別化 | 裏付けの質 |
| 8 | 戦略 ≠ 優位性 | 優位性の定義 |
| 10 | ネガティブケース（断念例） | 裏付けの質 |
| 11 | 業界構造×企業ポジション合致 | 裏付けの質 |
```

### 3.2 トークン量の見積もり

| 項目 | トークン量（目安） |
|------|-------------------|
| ゲートキーパー: ルール9, 3（定義＋具体例） | ~300 |
| CAGR接続: ルール5（＋確度統合補足）, 12 | ~300 |
| 12ルール一覧表（定義のみ、目次） | ~200 |
| 構造化出力フォーマット指定（JSONスキーマ） | ~200 |
| **合計** | **~1,050** |

---

## 4. ワークフロー設計

### 4.1 全体構成

単一ワークフロー・直列10ノード（LLM×6 + 知識検索×4）。

```
入力:
  アナリストレポート → ファイルアップロード
  10-K/10-Q → KB4（銘柄ごとのナレッジベース）

ワークフロー:

  [アナリストレポート]──┐
                       ↓
  [知識検索①: KB4]    → [LLM①: ステップ1 主張抽出]
                         入力: レポート + KB4検索結果
                         出力: JSON（3種別のclaims配列）
                           ↓
  [知識検索②: KB1+KB3] → [LLM②: ステップ2 ルール適用]
                         入力: ステップ1 JSON + KB1/KB3検索結果
                         出力: JSON（rule_evaluation追加）
                           ↓
  [知識検索③: KB4]     → [LLM③: ステップ3 ファクトチェック]
                         入力: ステップ2 JSON + KB4検索結果
                         出力: JSON（verification_status追加）
                           ↓
  [知識検索④: KB2]     → [LLM④: ステップ4 検証（JSON）]
                         入力: ステップ3 JSON + KB2検索結果
                         出力: JSON（検証結果追加）
                           ↓
                        [LLM⑤: ステップ5 レポート生成]
                         入力: ステップ4 JSON
                         出力: Markdownレポート
                           ↓
  [知識検索⑤: KB1+KB2] → [LLM⑥: ステップ6 レポート検証]
                         入力: ステップ4 JSON + ステップ5 レポート + KB1/KB2検索結果
                         出力: 検証済み最終レポート
                           ↓
                        [最終レポート出力]
```

### 4.2 知識検索ノードの設定

| 知識検索 | 対象KB | 使用ステップ | Top-K | 検索クエリ |
|---------|--------|-------------|-------|-----------|
| ① | KB4 | ステップ1 | — | レポート内の企業名・セグメント名 |
| ② | KB1 + KB3 | ステップ2 | 5 | 各主張のclaimテキスト |
| ③ | KB4 | ステップ3 | — | factual_claimのテキスト |
| ④ | KB2 | ステップ4 | 4 | 各主張のclaimテキスト |
| ⑤ | KB1 + KB2 | ステップ6 | 5 | レポート内の主要な主張テキスト |

検索クエリは主張テキストを直接使用する（判断4）。LLMによるクエリ生成は行わない。

---

## 5. 各ステップの詳細設計

### 5.1 ステップ1: 主張抽出

**目的**: アナリストレポートから競争優位性・CAGR接続・事実に関する主張を抽出し、10-K/10-Qの事実と紐付ける。

**入力**:
- アナリストレポート（ファイルアップロード）
- KB4検索結果（10-K/10-Qの関連セクション）

**処理内容**:
1. レポートから競争優位性の主張を抽出
2. 各主張のCAGR接続（主張がCAGRにどう寄与するか）を抽出
3. 主張の根拠となる事実（数値・データ）を抽出
4. 10-K/10-Qの事実と紐付け

**出力**: JSON（3種別のclaims配列）

```json
{
  "ticker": "XYZ",
  "report_source": "アナリストA",
  "claims": [
    {
      "id": 1,
      "claim_type": "competitive_advantage",
      "claim": "主張テキスト",
      "descriptive_label": "記述的ラベル",
      "evidence_from_report": "レポート内の根拠（ページ番号付き）",
      "supported_by_facts": [],
      "cagr_connections": []
    },
    {
      "id": 2,
      "claim_type": "cagr_connection",
      "claim": "CAGR接続の主張テキスト",
      "descriptive_label": "記述的ラベル",
      "source_advantage": 1
    },
    {
      "id": 3,
      "claim_type": "factual_claim",
      "claim": "事実の主張テキスト",
      "affected_claims": [1]
    }
  ]
}
```

**ステップ固有プロンプト指示**:
- KYの観点に沿わない主張も削ぎ落とさない
- レポート内のページ番号・セクション番号を必ず引用する
- 1つのレポートから5〜15件程度の主張を抽出する（過少・過多にならないよう調整）

### 5.2 ステップ2: ルール適用

**目的**: ステップ1で抽出した各主張に、KYの12ルールを適用し評価する。

**入力**:
- ステップ1のJSON出力
- KB1検索結果（該当ルール＋具体例）
- KB3検索結果（類似銘柄のKY評価例）

**処理内容**:
1. 各`competitive_advantage`にルール1,2,3,6,7,8,10,11を照合
2. 各`cagr_connection`にルール5,12を照合
3. KB3のfew-shot例を参照し、類似の主張に対するKYの評価を参考にする
4. 確信度（confidence）を算出

**出力**: JSON（`rule_evaluation`フィールド追加）

```json
{
  "rule_evaluation": {
    "applied_rules": ["rule_6", "rule_11"],
    "results": [
      {
        "rule": "rule_6",
        "verdict": "structural",
        "reasoning": "具体的な判断理由"
      }
    ],
    "confidence": 90,
    "confidence_adjustments": [],
    "overall_reasoning": "総合判断の理由"
  }
}
```

**ステップ固有プロンプト指示**:
- 該当するルールを必ず1つ以上適用する
- verdictは具体的な判断結果（"structural", "complementary", "pass", "fail"等）を記述
- confidenceはKYの過去評価（10%/20-30%/50%/70%/90%）のスケールに合わせる
- ナレッジベースの具体例と照合し、類似ケースがあれば参照する

### 5.3 ステップ3: ファクトチェック

**目的**: `factual_claim`の事実を10-K/10-Qで検証し、検証結果を記録する。

**入力**:
- ステップ2のJSON出力
- KB4検索結果（10-K/10-Qの関連セクション）

**処理内容**:
1. 各`factual_claim`のテキストでKB4を検索
2. 10-K/10-Qの記載と照合
3. 検証結果を3段階で記録

**出力**: JSON（`verification_status`等のフィールド追加）

```json
{
  "id": 3,
  "claim_type": "factual_claim",
  "claim": "店舗数5,829",
  "verification_status": "verified | contradicted | unverifiable",
  "verification_attempted": [
    "2024年10-K Item 2: 'We operated 5,829 stores as of December 31, 2024'"
  ],
  "what_would_verify": null,
  "confidence_impact": "none | moderate | critical",
  "affected_claims": [1]
}
```

**verification_statusと後続処理**:

| verification_status | 処理 | confidence への影響 |
|----|----|----|
| `verified` | そのまま通過 | なし |
| `contradicted` | ルール9自動適用。依存する主張のconfidence → 10%。**主張は削除しない** | critical |
| `unverifiable` | アノテーション付与（検証を試みたソース＋何があれば検証できるか）。依存する主張のconfidenceを減算（-10〜20%） | moderate |

**ステップ固有プロンプト指示**:
- 検証不可の場合は「何があれば検証できるか」（`what_would_verify`）を必ず記述する
- 10-K/10-Qに記載がない場合でも、検索を試みたセクションを`verification_attempted`に記録する
- **主張は絶対に破棄しない**（原則P5）

### 5.4 ステップ4: 検証（JSON）

**目的**: ステップ3までのJSON全体を、却下/高評価パターンと照合して検証する。

**入力**:
- ステップ3のJSON出力
- KB2検索結果（却下パターンA〜G、高評価パターンI〜V）

**処理内容**:
1. 各`competitive_advantage`を却下パターンA〜Gと照合
2. 高評価パターンI〜Vとの一致を確認
3. パターン該当の見落としがないか検証
4. ルール適用の漏れがないか検証
5. 必要に応じてconfidenceを調整

**出力**: JSON（検証結果追加、confidence調整反映）

```json
{
  "confidence_adjustments": [
    {
      "reason": "パターンA（結果を原因と取り違え）に該当",
      "adjustment": -30,
      "pattern": "A"
    }
  ]
}
```

**ステップ固有プロンプト指示**:
- KB2から取得したパターンの具体例と照合する
- パターンに該当する場合はconfidenceを調整し、調整理由を記録する
- ステップ2で見落とされたルール適用があれば追加する

### 5.5 ステップ5: レポート生成

**目的**: ステップ4の確定JSONからKYに提示する自然言語レポートを生成する。

**入力**:
- ステップ4のJSON出力

**処理内容**:
1. JSONの各主張をMarkdownレポートに変換
2. 主張ごとのフィードバックテンプレートを埋め込み
3. レポート末尾に全体評価欄を配置

**出力**: Markdownレポート

レポート構成:
```markdown
# [ティッカー] 競争優位性評価レポート

## レポート情報
- 対象銘柄: [ティッカー]
- 入力レポート: [アナリスト名]
- 生成日: [日付]

---

## 競争優位性候補

### #1: [主張テキスト]

**分類**: [descriptive_label]
**確信度**: [X]%

**根拠**:
[evidence_from_report]

**ルール適用結果**:
- ルール[N]: [verdict] — [reasoning]

**ファクトチェック**:
- [verification_statusに応じた記述]

**CAGR接続**: [接続先がある場合]

---

**納得度:**  10% / 30% / 50% / 70% / 90%  ← 丸をつける

**該当する質問に一言お願いします（1文で十分です）:**

- 納得しない場合 → 一番引っかかる点は？
- どちらとも言えない場合 → 何があれば納得度が上がる？
- 納得する場合 → 他の企業でも同じことが言えない理由は？

回答:


**補足（任意）:**


---

[以下、#2〜#N まで同様]

---

## 全体フィードバック

**レポート全体として、あなたの考え方に沿った議論ができていますか？**

□ 概ね沿っている  □ 部分的に沿っている  □ 沿っていない

**最も良かった主張の番号:**  #___
**最も問題のある主張の番号:**  #___

**その他コメント（任意）:**

```

**ステップ固有プロンプト指示**:
- JSONの内容を忠実にレポートに変換する。好意的な拡大解釈をしない
- confidenceとレポートのトーンを一致させる（confidence 30%の主張を肯定的に書かない）
- unverifiable/contradictedな事実は明示的にレポートに記載する
- フィードバックテンプレートは省略しない

### 5.6 ステップ6: レポート検証

**目的**: ステップ5で生成したレポートを、JSONおよびKYのナレッジベースと照合して検証する。

**入力**:
- ステップ4のJSON出力
- ステップ5のMarkdownレポート
- KB1検索結果（ルール集）
- KB2検索結果（パターン集）

**処理内容**: 3層検証

| 検証層 | 内容 | 検出する問題 |
|--------|------|-------------|
| 検証A: JSON-レポート整合 | confidenceとトーンの一致、主張の網羅性、数値の転記正確性 | レポート生成時の拡大解釈・トーンの歪み・主張の削ぎ落とし |
| 検証B: KYルールとの整合 | 12ルールに沿った議論ができているか | ルール適用の記述がレポート内で正しく反映されているか |
| 検証C: パターンとの整合 | 却下/高評価パターンの表現レベルでのチェック | confidence 30%の主張が肯定的に書かれていないか等 |

**出力**: 検証済み最終レポート or 不整合箇所の指摘付きレポート

```markdown
## 検証結果

### 検証A: JSON-レポート整合
- [✓] 全主張がレポートに含まれている
- [✓] confidenceとトーンが一致している
- [!] 主張#3のconfidence 30%に対してレポート内の記述がやや肯定的

### 検証B: KYルールとの整合
- [✓] ルール1（能力≠結果）が正しく反映されている
- [✓] ルール3（相対的優位性）の適用が適切

### 検証C: パターンとの整合
- [!] パターンD（定量的裏付けなし）に該当する可能性があるが、レポートで言及されていない

---

[不整合がある場合は修正版レポートを出力]
[不整合がない場合はステップ5のレポートをそのまま出力]
```

**ステップ固有プロンプト指示**:
- 検証結果は各検証層ごとに記録する
- 不整合が軽微な場合は修正版レポートを出力する
- 不整合が重大な場合は指摘のみ行い、修正はステップ5の再実行に委ねる

### 5.7 ステップ4とステップ6の役割分担

| | ステップ4（JSON検証） | ステップ6（レポート検証） |
|---|---------|---------|
| 検証対象 | JSON（構造化データ） | Markdownレポート（自然言語） |
| 使うKB | KB2（パターン集） | KB1（ルール集）+ KB2（パターン集） |
| 検出できる問題 | ルール適用の漏れ、パターン該当の見落とし | レポート生成時の拡大解釈・トーンの歪み・主張の削ぎ落とし |
| 目的 | 構造化データの論理的整合性 | KYに届くレポートがKYの判断軸に沿った表現になっているか |

ステップ6は議論7（6.5）で指摘された「推論→出力の断絶」を**レポートレベルで検出する最後の砦**。

---

## 6. 構造化JSON出力スキーマ（完全版）

ステップ4完了時点の最終JSON形式:

```json
{
  "ticker": "XYZ",
  "report_source": "アナリストA",
  "claims": [
    {
      "id": 1,
      "claim_type": "competitive_advantage",
      "claim": "ローカルな規模の経済による配送・在庫の効率化",
      "descriptive_label": "配送密度による原価優位",
      "evidence_from_report": "店舗数5,800超、配送センター30拠点（レポートp.8）",
      "supported_by_facts": [3, 4],
      "cagr_connections": [2],
      "rule_evaluation": {
        "applied_rules": ["rule_6", "rule_11"],
        "results": [
          {
            "rule": "rule_6",
            "verdict": "structural",
            "reasoning": "配送密度は競合が容易に再現できない構造的優位"
          },
          {
            "rule": "rule_11",
            "verdict": "pass",
            "reasoning": "フラグメント市場における規模・密度の優位が市場構造と合致"
          }
        ],
        "confidence": 90,
        "confidence_adjustments": [],
        "overall_reasoning": "市場構造との合致が明確。ルール11の典型的な高評価パターン"
      }
    },
    {
      "id": 2,
      "claim_type": "cagr_connection",
      "claim": "店舗密度の拡大 → 配送効率 → マージン改善 → 営業利益CAGR +2pp",
      "descriptive_label": "配送密度→マージン改善経路",
      "source_advantage": 1,
      "rule_evaluation": {
        "applied_rules": ["rule_5", "rule_12"],
        "results": [
          {
            "rule": "rule_5",
            "verdict": "direct",
            "reasoning": "2ステップの因果。配送効率→マージンは10-Kの費用構造から検証可能"
          }
        ],
        "confidence": 80,
        "confidence_adjustments": [],
        "overall_reasoning": "因果メカニズムが直接的で検証可能"
      }
    },
    {
      "id": 3,
      "claim_type": "factual_claim",
      "claim": "店舗数5,829",
      "verification_status": "verified",
      "verification_attempted": [
        "2024年10-K Item 2: 'We operated 5,829 stores as of December 31, 2024'"
      ],
      "what_would_verify": null,
      "confidence_impact": "none",
      "affected_claims": [1]
    },
    {
      "id": 4,
      "claim_type": "factual_claim",
      "claim": "市場シェア25%で業界2位",
      "verification_status": "unverifiable",
      "verification_attempted": [
        "2024年10-K: 市場シェアに関する開示なし",
        "10-K Item 1 Business: 業界内ポジションの定性記述のみ、数値なし"
      ],
      "what_would_verify": "業界団体統計、第三者市場調査レポート（Euromonitor等）",
      "confidence_impact": "moderate",
      "affected_claims": [1]
    }
  ]
}
```

---

## 7. 入力仕様

### 7.1 ワークフロー入力

| 入力 | 方式 | 形式 | 備考 |
|------|------|------|------|
| アナリストレポート | ファイルアップロード | PDF/Word/Markdown | LLMコンテキストに収まるサイズ |
| 10-K/10-Q | KB4（ナレッジベース） | テキスト（チャンク分割済） | 銘柄ごとに事前準備 |
| ティッカーシンボル | テキスト入力 | 文字列 | KB4の検索範囲指定に使用 |

### 7.2 ワークフロー出力

| 出力 | 形式 | 内容 |
|------|------|------|
| 最終レポート | Markdown | KYへのフィードバック依頼用レポート（フィードバックテンプレート埋込） |
| 構造化JSON | JSON | ステップ4完了時点の全claims（分析用アーカイブ） |
| 検証結果 | Markdown | ステップ6の3層検証結果 |

---

## 8. 改善サイクルとの接続

### 8.1 フィードバックの流れ

```
Difyワークフロー実行
  ↓
最終レポート（Markdown）をKYに提出
  ↓
KYがフィードバックテンプレートに記入
  ↓
フィードバック分析
├── 却下パターン（A〜G）の出現をカウント
├── 高評価パターン（I〜V）の出現をカウント
└── 新規パターンの出現 → ルール追加候補
  ↓
ルール精緻化
├── 既存ルールの補足追加 → KB1のチャンク更新
├── 新規ルール追加 → KB1にチャンク追加 + システムプロンプトの一覧表更新
├── 新規パターン追加 → KB2にチャンク追加
└── few-shot例追加 → KB3にチャンク追加
  ↓
Phase 0 v2（改善版）
```

### 8.2 KBの更新箇所

| フィードバック内容 | 更新対象 |
|------------------|---------|
| 既存ルールの具体例追加 | KB1の該当チャンク |
| 新規ルール | KB1にチャンク追加 + システムプロンプト一覧表 |
| 新規却下/高評価パターン | KB2にチャンク追加 |
| 新規few-shot例 | KB3にチャンク追加 |
| KY固有の分類軸の確立 | JSONスキーマの`descriptive_label`を分類軸に置換 |

### 8.3 分類軸の進化

```
PoC v1: descriptive_label（自由記述）
  ↓ KYのフィードバック蓄積（5〜10銘柄）
PoC v2: KY固有の分類軸を仮説化・確認・導入
```

---

## 9. PoC実行チェックリスト

### 事前準備

- [ ] KB1: 8チャンク（ルール1,2,4,6,7,8,10,11）のテキスト作成
- [ ] KB2: 12チャンク（却下A〜G、高評価I〜V）のテキスト作成
- [ ] KB3: 5チャンク（ORLY, COST, MNST, CHD, LLY）のテキスト作成
- [ ] KB4: PoC対象銘柄の10-Kをチャンク分割してアップロード
- [ ] Difyワークフローの構築（10ノード）
- [ ] 各LLMノードのシステムプロンプト作成
- [ ] PoC対象銘柄のアナリストレポート準備

### 実行

- [ ] ワークフロー実行（PoC銘柄1社目）
- [ ] 出力JSONの構造確認
- [ ] 出力レポートの形式確認
- [ ] KYにレポート提出・フィードバック依頼

### 評価

- [ ] KYのフィードバック回収
- [ ] 却下パターン出現のカウント
- [ ] 高評価パターン出現のカウント
- [ ] 新規パターンの有無確認
- [ ] 改善事項の特定 → Phase 0 v2 への反映

---

## 10. 関連ファイル

| ファイル | 説明 |
|---------|------|
| `analyst/memo/discussion_summary.md` | 全議論のサマリー（Phase 0〜Dify設計） |
| `analyst/memo/dify_design_discussion.md` | Dify設計議論ログ（13判断の議論詳細） |
| `analyst/memo/phase0_philosophy_injection_design.md` | Phase 0 設計メモ（12ルール、パターン、フィードバック設計） |
| `analyst/memo/phase0_discussion_log.md` | Phase 0 設計議論ログ（9議論） |
| `analyst/memo/cagr_estimation_framework.md` | CAGR推定フレームワーク全体設計 |
| `analyst/Competitive_Advantage/analyst_YK/judgment_patterns.md` | KYの判断パターン横断分析（12ルールの一次ソース） |
