# AI 競争優位性評価システム構築計画

## 目的

アナリスト・ファンドマネージャーが行う**競争優位性の評価**を再現できるAIシステムを構築する。

具体的には、銘柄に関するレポートや情報を入力として受け取り、特定のアナリスト/FMの判断軸（Dogma）に基づいて競争優位性仮説を生成・評価し、Phase 2 形式のスコアリング（確信度%）とコメントを出力する。

### スコープ

| 項目 | 内容 |
|------|------|
| **入力** | まずは社内アナリストレポート（`analyst/raw/`）。将来的に外部レポート・決算データ等も対象 |
| **出力** | 競争優位性評価（Phase 2 形式: 確信度% + コメント）。投資判断（買い/売り/保有）はFMが行う |
| **判断軸** | アナリスト/FM ごとに Dogma を定義し切替可能。現在は Y（吉沢）の Dogma を構築中 |
| **PoC環境** | 会社の Dify 環境でワークフローを構築中。本番環境で使用するツールは未定 |
| **設計資産** | Claude Code 側で Dogma・プロンプト・エージェント設計を構築・検証し、Dify 等の実装に活用 |

---

## システムアーキテクチャ

### パイプライン概要

```
入力（アナリストレポート / 銘柄情報）
    ↓
Phase 1: 競争優位性仮説の生成
    - レポートから競争優位性の候補を抽出・構造化
    - CAGR パラメータとの接続仮説を生成
    - 出力: 仮説リスト（優位性名・根拠・CAGR接続）
    ↓
Phase 2: 競争優位性仮説の評価
    - アナリスト/FM の Dogma に基づいて各仮説を評価
    - 確信度スコア（90/70/50/30/10%）とコメントを生成
    - 優位性の存在評価と CAGR 接続評価を独立実施
    - 出力: 評価テーブル + 全体印象 + 警鐘事項
```

### マルチアナリスト設計

```
analyst/Competitive_Advantage/
├── analyst_YK/          # Y（吉沢）の判断軸
│   ├── dogma.md         # 運用版 Dogma（AI参照用）
│   ├── dogma_draft.md   # 検証版（Y 確認用 ○/×/△）
│   ├── judgment_patterns.md  # Phase 2 横断分析
│   └── feedback.md      # Y のフィードバック記録
├── analyst_K/           # K の判断軸（将来）
│   └── Competitive_Advantage_Dogma.md  # 既存（サンプル）
└── analyst_{name}/      # 他アナリスト（将来拡張）
    └── dogma.md
```

Dogma を差し替えることで、同じパイプラインを異なるアナリスト/FM の視点で実行できる。

---

## 既存の分析フロー（現状）

```
analyst/raw/（複数の人間アナリストが作成したレポート）
    ↓
AI が template_ver2.md + プロンプトに基づき競争優位性仮説を生成（Phase 1）
（※ 現在の Dogma.md は使用されていない。AI 生成の中間レポートも未保存）
    ↓
Y（吉沢）が AI 出力を批評 → feedback.md（定性フィードバック）
                           → phase2_KY/（確信度の直接スコアリング）
```

**注意:**

- `Competitive_Advantage_Dogma.md` は **アナリスト K の投資判断軸**（サンプルとして後から配置）
- Y が批評した AI レポートは **Dogma.md に基づいて生成されたものではない**
- `template_ver2.md` は Phase 1 生成に使用されたが、Dogma.md とは独立
- Phase 2 の確信度スコアは **Y が直接付けたもの**（最も信頼度の高いデータ）

---

## 既存資産

| 資産 | パス | 性質 |
|------|------|------|
| **Y 版 Dogma（運用版）** | `analyst/Competitive_Advantage/analyst_YK/dogma.md` | Phase 2 評価エンジンの参照用 |
| **Y 版 Dogma（検証用）** | `analyst/Competitive_Advantage/analyst_YK/dogma_draft.md` | Y に ○/×/△ で検証してもらうための版 |
| **Y の判断パターン横断分析** | `analyst/Competitive_Advantage/analyst_YK/judgment_patterns.md` | Phase 2 全5銘柄の横断分析（12ルール抽出済み） |
| Y の定性フィードバック | `analyst/Competitive_Advantage/analyst_YK/feedback.md` | AI 出力への修正・批判（Y の暗黙知の宝庫） |
| Y の直接スコアリング | `analyst/phase2_KY/` | 5銘柄の確信度評価（CHD, COST, LLY, MNST, ORLY） |
| アナリスト K の判断軸 | `analyst/Competitive_Advantage/Competitive_Advantage_Dogma.md` | K の投資哲学（サンプル・参考用） |
| アナリストレポート | `analyst/raw/` | 12銘柄の詳細レポート（入力データ） |
| Phase 1 生成用プロンプト | `analyst/Competitive_Advantage/Competitive_Advantage_template_ver2.md` | Phase 1 の仮説生成に使用 |
| フォーマット例 | feedback.md 内の MSFT/TSMC セクション | AI が参照するフォーマット規範 |
| 7 Powers テンプレート | `analyst/prompt/seven_powers_extract.md` | Hamilton Helmer の7 Powers に基づく JSON 抽出テンプレート |
| Phase 1 サンプル | `analyst/phase1/ANET_phase1.md` | AI 生成レポートのサンプル |
| **Phase 2 評価エージェント** | `.claude/agents/competitive-advantage-critique.md` | Y の判断軸で競争優位性仮説を評価するエージェント |

---

## Y の投資哲学（Phase 2 スコアリングパターンから抽出）

### Y のスコアリング体系

| ランク | 確信度 | 日本語表現 |
|--------|--------|------------|
| かなり納得 | 90% | 構造的優位性 + 明確なCAGR接続 + 定量的裏付け |
| おおむね納得 | 70% | 妥当な仮説 + 一定の裏付け |
| まあ納得 | 50% | 方向性は認めるが裏付け不十分 |
| あまり納得しない | 30% | 飛躍的解釈・因果関係の逆転 |
| 却下 | 10% | 事実誤認・競争優位性として不成立 |

### Y が却下する典型パターン（10-30%）

1. **結果を原因と取り違え**: 「高シェアは結果であり背後要因が乏しい」（MNST #1）
2. **どの企業にも言える一般論**: 「多くの企業が言っていること」（COST #5）
3. **競合との差別化が不明**: 「純粋競合に対して優位な設計かは不明」（COST #3）
4. **事実誤認**: 「OPMをGPMと誤認」（MNST #6）
5. **飛躍的解釈**: 「低所得→コンビニ購買率高い→粘着力高い は飛躍」（MNST #5）
6. **定性的で定量的裏付けなし**: 「売り場づくりの定性的差異がわかりにくく定量評価もしがたい」（COST #2）
7. **戦略を優位性と混同**: 「ドミナント出店戦略＝戦略は優位性ではないのでは」（ORLY）

### Y が高く評価する典型パターン（70-90%）

1. **定量的裏付け**: 「意味のある数値裏付けは納得感を高める」（COST #1: 退職率9% vs 業界20%+）
2. **直接的なCAGR接続メカニズム**: 「上級会員ミックス改善→ARPU向上→既存店売上成長に直接影響」（COST 顧客粘着力: 90%）
3. **能力 > 結果**: 「ポート管理能力が優位性、ポートシフトは結果」（CHD #3）
4. **明確な因果チェーン**: 「買収基準の明確化→人員投入・精査→選定能力」（CHD #1: 70%）
5. **他社事例との類推**: ブランド力評価で過去の判断事例を参照（MNST #1の詳細コメント）
6. **構造的 vs 補完的の区別**: CAGR寄与を構造的要素と補完的要素に分類（COST ガソリン戦略）

### Y のフィードバックから抽出した暗黙知（feedback.md）

1. **優位性は「名詞」で表現される属性**: ブランド力、スイッチングコスト、エコシステム等
2. **相対的優位性の要求**: 「メガファーマなら誰でも持っている」 → 優位性ではない
3. **CAGR 接続での確度の分離**: 優位性の有無と CAGR 数値への寄与を独立評価すべき
4. **期初レポート > 四半期レビュー**: ① が主、② が従。AI が ② を拡大解釈する問題
5. **既存判断への警鐘機能**: FM/AN が既存判断に縛られることへの対策を AI に期待
6. **推論の一貫性**: 銘柄ごとに推論パターンが異なることへの不満
7. **AI の推論段階の批判が最終出力で消える**: STEP3で好意的に拡大解釈される問題
8. **フォーマット例の影響**: MSFT/TSMCを参考例として与えると他銘柄への批判が強くなる → Few-shot examples の選択が結果を大きく左右する

### Y のブランド力評価フレームワーク（MNST Phase 2 コメントから抽出）

Y は過去の判断事例を明示的に参照しており、体系的なブランド評価基準を持っている:

1. **ブランド「ポートフォリオ」運営力**: 買収→ポート管理（ロレアル、ロリンズ）、地域別マルチ/単独戦略（アトラスコプコ）
2. **知名度・ブランド認知**: 圧倒的知名度（MSFT, AAPL, AMZN, Disney）、デファクト認知度（MSCI, MCO, S&P）、差別化認知（SBUX）
3. **価値の維持・通貨代替機能**: 高残価価値（AAPL, エルメス, フェラーリ）、通貨代替（マルボロ, ディアジオ）
4. **ブランドキーパーソンの経営層取り込み**: デザイン・ブランド責任者のC-suite化（コーチ/タペストリー, AAPL）
   → Y 自身の自己評価: 「外見的な評価が多く、背後要因をもとにした評価が少ない印象」

---

## 現状の課題

### 課題 1: AI 推論の不安定性

- 銘柄ごとに推論パターンが大きく異なる（LLY で「考え直す」批判が続出、他銘柄では穏やか）
- STEP3 での最終出力で推論段階の批判が消えて好意的に拡大解釈される
- **根本原因**: Few-shot examples（MSFT/TSMC）の影響で AI がフォーマットを模倣しようとし、参照例に批判的な推論が発生

### 課題 2: コンテキスト理解の限界

- アナリストの意図を誤読（CDNS の技術革新: 顧客サイドの革新 vs 企業サイドの投資必要性）
- 前提知識の ① 期初レポートと ② 四半期レビューを並列評価（本来は ①主、②従）
- **Y の表現**: 「②の積み重ねから拡大解釈するのでなく、①の妥当性を再検討させるような仕組み考えられないのでしょうか？」

### 課題 3: CAGR パラメータの一貫性

- LLY では確度と寄与を分離、CHD では確度を寄与に取り込む → 一貫性なし
- 数値の根拠が不透明（+1-2% の背景不明）
- **Y の方針**: 「優位性と CAGR 下支えの評価は独立して行い、優位性が100%あるものとして、CAGR接続への納得度評価とする」

### 課題 4: 既存判断の無批判的受容

- Y が最も欲しいのは「既存判断への警鐘」だが、AI は受容・拡大解釈する傾向
- **Y の表現**: 「FMやANが既存判断に縛られて、当初の合理性を欠いていることへの警鐘的機能ほしいです」

### 課題 5: AI が結果を原因に取り違える

- Phase 2 で Y が繰り返し指摘: 「シェアは結果であって原因ではない」「ポートシフトは結果、管理力が優位性」
- AI はアナリストレポートから「競争優位性らしき部分を抽出して競争優位としている」（COST 全体印象）

### 課題 6: Phase 1 → Phase 2 パイプラインの未統合

- Phase 1（仮説生成）と Phase 2（評価）が別々のプロンプト/ワークフローで動作
- Dogma が Phase 1 生成プロセスに組み込まれていない
- 入力→仮説生成→評価→出力の一気通貫フローが存在しない

---

## 開発ロードマップ

### Stage 1: 判断軸の抽出・文書化【完了】

Y の Phase 2 スコアリングデータと定性フィードバックから、投資判断の暗黙知を明示的なルールとして文書化した。

**成果物:**

| 成果物 | パス | 説明 |
|--------|------|------|
| 判断パターン横断分析 | `analyst_YK/judgment_patterns.md` | 12ルール、7却下パターン、5高評価パターン、ブランド4類型 |
| Dogma 運用版 | `analyst_YK/dogma.md` | AI が参照する判断基準（7セクション構成） |
| Dogma 検証版 | `analyst_YK/dogma_draft.md` | Y 確認用（○/×/△ + 追加質問 Q1-Q6） |

**残タスク:**

- [ ] Y による `dogma_draft.md` の ○/×/△ 検証（人間アクション待ち）
- [ ] 検証結果を受けた `dogma.md` の改訂

### Stage 2: Phase 2 評価エンジンの構築と検証【進行中】

Dogma に基づいて競争優位性仮説を評価するエンジン（Phase 2 の自動化）を構築・検証する。

#### 2.1 評価エージェントのプロトタイプ【完了】

- `.claude/agents/competitive-advantage-critique.md` として定義
- 5ステップ処理: Dogma 読込 → 入力読込 → 仮説批評 → スコア決定 → 警鐘機能
- Phase 2 形式の出力テーブル + 検証モード内蔵

#### 2.2 In-sample 検証【次のステップ】

- 既存 Phase 2 データ（CHD, COST, LLY, MNST, ORLY）に対して評価エージェントを実行
- AI 生成スコアと Y の実スコアの乖離を測定（目標: 平均 ±10% 以内）
- 乖離が大きい項目の原因分析 → Dogma の改善ポイント特定

#### 2.3 Out-of-sample 検証

- Phase 2 の学習データに含まれない銘柄（ANET, AME, CPRT 等）で評価を実行
- Y に結果を見せてフィードバックを取得
- Dogma のカバレッジ不足・過剰一般化を検出

#### 2.4 Few-shot Examples の再設計

- Y が高評価した分析を「良い例」として選定
- Y が却下した分析を「悪い例」として選定
- AI への参照例の選択が結果を大きく左右することが判明 → 意図的にコントロール

### Stage 3: Phase 1 仮説生成の改善

Phase 1（競争優位性仮説の生成）の品質を向上させ、Phase 2 評価との一貫性を確保する。

#### 3.1 仮説生成プロンプトの改善

- 既存の `template_ver2.md` を Dogma と整合させる
- Y の却下パターンを事前に回避する生成ルールを組み込む
- 「結果 vs 原因」「戦略 vs 優位性」の区別を生成段階で強制

#### 3.2 情報ソース優先順位の明示化

- ① 期初レポート（主）と ② 四半期レビュー（従）の重み付け
- ② からの拡大解釈を検出・抑制するメカニズム

#### 3.3 一貫性の確保

- CAGR パラメータ処理のルール統一（優位性確信度と CAGR 接続は独立評価）
- 推論パターンの標準化（銘柄間で一貫した推論フロー）

### Stage 4: パイプラインの統合

Phase 1 → Phase 2 を一気通貫で実行できるパイプラインを構築する。

#### 4.1 入力→出力の自動化

- アナリストレポートを入力として渡すだけで、評価結果が出力されるフロー
- Dify PoC 環境でのワークフロー実装

#### 4.2 マルチアナリスト対応

- Dogma 切替による複数アナリスト/FM の判断軸サポート
- K の Dogma → K モード、Y の Dogma → Y モード
- 各アナリストの判断軸ファイルを `analyst/Competitive_Advantage/analyst_{name}/dogma.md` に統一配置

#### 4.3 警鐘機能の実装

- 既存判断に無批判に従っている仮説の検出
- ① 期初レポートの前提が現在も合理的かの検証
- ② 四半期レビューの拡大解釈の検出・警告
- Y が最も望む機能: 「FM/AN が既存判断に縛られていることへの警鐘」

### Stage 5: マルチエージェント化（将来構想）

評価の多角化のため、複数の専門エージェントによる弁証法的アーキテクチャを構築する。

```
評価パイプライン
├── Phase 1: 仮説生成エージェント
│   └── レポートから構造化された競争優位性仮説を生成
├── Phase 2: 評価エージェント群
│   ├── Competitive Advantage Evaluator（Dogma に基づく主評価）
│   ├── Causality Checker（結果 vs 原因の区別を強制）
│   ├── CAGR Validator（数値の根拠と一貫性を検証）
│   └── Historical Analogy Agent（過去判断事例との整合性チェック）
└── 警鐘機能
    └── Bias Detector（確認バイアス・初期判断への固執を検出）
```

---

## 完了済みアクション

### Action 1: Y の判断パターン横断分析レポート【完了】

**出力先**: `analyst/Competitive_Advantage/analyst_YK/judgment_patterns.md`

全5銘柄34項目の優位性スコア + 36項目のCAGR接続スコアを横断分析。12の判断ルール、7つの却下パターン、5つの高評価パターン、ブランド力評価4類型を抽出。

### Action 2: Y 版 Dogma 作成【完了】

| ファイル | 用途 |
|----------|------|
| `analyst/Competitive_Advantage/analyst_YK/dogma_draft.md` | Y への検証用（○/×/△ チェックリスト + 追加質問 Q1-Q6） |
| `analyst/Competitive_Advantage/analyst_YK/dogma.md` | 運用版（Phase 2 評価エンジン参照用） |

### Action 3: Phase 2 評価エージェントのプロトタイプ【完了】

- **エージェント定義**: `.claude/agents/competitive-advantage-critique.md`
- Dogma を読み込み、Phase 1 出力に対して Phase 2 形式の評価を生成
- 既存 Phase 2 データとの照合による精度検証モードを内蔵
- 目標: Y のスコアとの平均乖離 ±10% 以内

---

## 次のアクション

### Action 4: In-sample 検証の実行

- CHD または MNST の Phase 1 相当データを入力として評価エージェントを実行
- AI 生成スコアと Y の実スコアの乖離分析レポートを出力
- 乖離が大きい項目の原因分析 → Dogma の改善ポイント特定

### Action 5: Y による Dogma 検証

- `dogma_draft.md` の ○/×/△ を Y に回収（人間アクション）
- 検証結果を `dogma.md` に反映

### Action 6: Out-of-sample 検証

- Phase 2 学習データに含まれない銘柄で評価を実行
- Y にフィードバックを依頼

---

## 議論ログ

### Session 1（2026-02-06）

**Phase 1: 抽象的な設計議論**

- データ少量問題 → LLM の既存知識 + Y の「レンズ」装着
- Y の結論中心問題 → 低コスト検証ループ
- A vs B → レイヤードアプローチ（哲学 + 拡張の共存）
- エージェント構成 → 弁証法的アーキテクチャ

**Phase 2: データ分析と誤解の修正**

- `analyst/` ディレクトリの発見 → AI 分析システム（Phase 1/2）は既に存在
- 当初 `Competitive_Advantage_Dogma.md` を Y の哲学と誤認
- **重要な修正1**: Dogma.md はアナリスト K の判断軸（サンプルとして後から配置）、Y の哲学は未文書化
- **重要な修正2**: Y が批評した AI レポートは Dogma.md に基づいて生成されたものではなく、別のレポート
- Phase 2 のスコアは Y の直接判断（最も信頼度の高いデータ）

**Phase 3: Y の判断パターン深掘り分析**

- Phase 2 全5銘柄（CHD, COST, LLY, MNST, ORLY）を横断分析
- Y の却下パターン（10-30%）7類型を特定
- Y の高評価パターン（70-90%）6類型を特定
- Y のブランド力評価フレームワーク（4類型）を MNST コメントから抽出
- **課題の再定義**: 6つの課題を特定
- **即座のアクション**: ① 判断パターン横断分析 → ② Y 版 Dogma ドラフト → ③ 評価エージェントプロトタイプ

### Session 2（2026-02-09）

**Phase 4: Dogma 清書版作成 + 評価エージェント構築**

- プランファイルを `docs/plan/` → `analyst/` に移動
- `dogma_draft.md`（検証用）と `dogma.md`（運用版）を分離
- Phase 2 評価エージェント（`competitive-advantage-critique`）を作成
- Dify PoC 環境で並行構築中であることを記録

**Phase 5: プロジェクト目的の再定義**

- プロジェクトの目的は「Y に対する批判エージェント」ではなく、**Y をはじめとするアナリスト/FM の判断軸で競争優位性を評価できる AI システム**の構築
- 入力: まずは社内アナリストレポート → 将来的に外部情報も
- 出力: Phase 2 形式のスコアリング（確信度%）+ コメント（投資判断まではFMが行う）
- Dify は PoC 環境。本番ツールは未定。Claude Code 側は設計資産を構築・検証する場
- Stage 構成を Phase 1（仮説生成）→ Phase 2（評価）のパイプラインとして再定義
- 旧 Stage 4（完全 AI 運用チーム）はスコープ外に変更
