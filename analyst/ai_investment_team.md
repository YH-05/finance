# AI Investment Team 構築計画

## Context

外国株式アクティブファンドの運用チームにおいて、ファンドマネージャー Y（吉沢）の投資判断ロジック・暗黙知を AI エージェントに落とし込み、AI による投資判断の再現・拡張を目指す。

### 状況整理（修正版 2026-02-06）

**既存の分析フロー:**

```
analyst/raw/（複数の人間アナリストが作成したレポート）
    ↓
AI が別のプロンプト/レポートに基づき分析レポート生成
（※ 現在のDogma.mdは使用されていない。AI生成の中間レポートも未保存）
    ↓
Y（吉沢）が AI 出力を批評 → feedback.md（定性フィードバック）
                           → phase2/（確信度の直接スコアリング）
```

**注意: Dogma.md と AI 生成レポートの関係**

- `Competitive_Advantage_Dogma.md` は **アナリスト K の投資判断軸**（サンプルとして後から配置）
- Y が批評した AI レポートは **Dogma.md に基づいて生成されたものではない**（別のレポート）
- `template_ver2.md` は AI 生成に使用されたが、Dogma.md とは独立
- MSFT/TSMC フォーマット例は AI に与えた参考フォーマット

**重要な修正点:**

- **Y の投資哲学はまだ文書化されていない** → feedback.md と phase2 スコアから間接的に抽出が必要
- 将来はアナリストごとに判断軸をスイッチする設計を計画
- AI 生成の中間レポートが保存されていないため、Y の批判内容から「何がダメだったか」を推測する必要がある
- Phase 2 の確信度スコアは **Y が直接付けたもの**（最も信頼度の高いデータ）

**既存資産:**
| 資産 | パス | 性質 |
|------|------|------|
| アナリストKの判断軸 | `analyst/Competitive_Advantage/Competitive_Advantage_Dogma.md` | K の投資哲学（サンプル・参考用） |
| Y の定性フィードバック | `analyst/Competitive_Advantage/analyst_YK/feedback.md` | AI出力への修正・批判（Y の暗黙知の宝庫） |
| Y の直接スコアリング | `analyst/phase2_KY/` | 5銘柄の確信度評価（CHD, COST, LLY, MNST, ORLY） |
| アナリストレポート | `analyst/raw/` | 12銘柄の詳細レポート（入力データ） |
| AI生成用プロンプト | `analyst/Competitive_Advantage/Competitive_Advantage_template_ver2.md` | AI がレポートを生成する際に使用 |
| フォーマット例 | feedback.md 内の MSFT/TSMC セクション | AI が参照するフォーマット規範 |
| 7 Powers テンプレート | `analyst/prompt/seven_powers_extract.md` | Hamilton Helmer の7 Powers に基づく JSON 抽出テンプレート |
| Phase 1 サンプル | `analyst/phase1/ANET_phase1.md` | AI生成レポートのサンプル |
| **Y の判断パターン横断分析** | `analyst/Competitive_Advantage/analyst_YK/judgment_patterns.md` | **Phase 2 全5銘柄の横断分析（12ルール抽出済み）** |
| **Y 版 Dogma（運用版）** | `analyst/Competitive_Advantage/analyst_YK/dogma.md` | **Critique Agent 参照用の清書版** |
| **Y 版 Dogma（検証用）** | `analyst/Competitive_Advantage/analyst_YK/dogma_draft.md` | **Y に ○/×/△ で検証してもらうための版** |
| **Critique Agent** | `.claude/agents/competitive-advantage-critique.md` | **Y の判断軸で競争優位性を批評するエージェント** |

---

## Y の投資哲学（Phase 2 スコアリングパターンから抽出）

### Y のスコアリング体系

| ランク           | 確信度 | 日本語表現                                   |
| ---------------- | ------ | -------------------------------------------- |
| かなり納得       | 90%    | 構造的優位性 + 明確なCAGR接続 + 定量的裏付け |
| おおむね納得     | 70%    | 妥当な仮説 + 一定の裏付け                    |
| まあ納得         | 50%    | 方向性は認めるが裏付け不十分                 |
| あまり納得しない | 30%    | 飛躍的解釈・因果関係の逆転                   |
| 却下             | 10%    | 事実誤認・競争優位性として不成立             |

### Y が却下する典型パターン（10-30%）

1. **結果を原因と取り違え**: 「高シェアは結果であり背後要因が乏しい」（MNST #1）
2. **どの企業にも言える一般論**: 「多くの企業が言っていること」（COST #5）
3. **競合との差別化が不明**: 「純粋競合に対して優位な設計かは不明」（COST #3）
4. **事実誤認**: 「OPMをGPMと誤認」（MNST #6）
5. **飛躍的解釈**: 「低所得→コンビニ購買率高い→粘着力高い は飛躍」（MNST #5）
6. **定性的で定量的裏付けなし**: 「売り場づくりの定性的差異がわかりにくく定量評価もしがたい」（COST #2）
7. **戦略を優位性と混同**: 「ドミナント出店戦略＝戦略は優位性ではないのでは」（ORLY）

### Y が高く評価する典型パターン（70-90%）

1. **定量的裏付け**: 「意味のある数値裏付けは納得感を高める」（COST #1: 退職率9% vs 業界20%+）
2. **直接的なCAGR接続メカニズム**: 「上級会員ミックス改善→ARPU向上→既存店売上成長に直接影響」（COST 顧客粘着力: 90%）
3. **能力 > 結果**: 「ポート管理能力が優位性、ポートシフトは結果」（CHD #3）
4. **明確な因果チェーン**: 「買収基準の明確化→人員投入・精査→選定能力」（CHD #1: 70%）
5. **他社事例との類推**: ブランド力評価で過去の判断事例を参照（MNST #1の詳細コメント）
6. **構造的 vs 補完的の区別**: CAGR寄与を構造的要素と補完的要素に分類（COST ガソリン戦略）

### Y のフィードバックから抽出した暗黙知（feedback.md）

1. **優位性は「名詞」で表現される属性**: ブランド力、スイッチングコスト、エコシステム等
2. **相対的優位性の要求**: 「メガファーマなら誰でも持っている」 → 優位性ではない
3. **CAGR 接続での確度の分離**: 優位性の有無と CAGR 数値への寄与を独立評価すべき
4. **期初レポート > 四半期レビュー**: ① が主、② が従。AI が ② を拡大解釈する問題
5. **既存判断への警鐘機能**: FM/AN が既存判断に縛られることへの対策を AI に期待
6. **推論の一貫性**: 銘柄ごとに推論パターンが異なることへの不満
7. **AI の推論段階の批判が最終出力で消える**: STEP3で好意的に拡大解釈される問題
8. **フォーマット例の影響**: MSFT/TSMCを参考例として与えると他銘柄への批判が強くなる → Few-shot examples の選択が結果を大きく左右する

### Y のブランド力評価フレームワーク（MNST Phase 2 コメントから抽出）

Y は過去の判断事例を明示的に参照しており、体系的なブランド評価基準を持っている:

1. **ブランド「ポートフォリオ」運営力**: 買収→ポート管理（ロレアル、ロリンズ）、地域別マルチ/単独戦略（アトラスコプコ）
2. **知名度・ブランド認知**: 圧倒的知名度（MSFT, AAPL, AMZN, Disney）、デファクト認知度（MSCI, MCO, S&P）、差別化認知（SBUX）
3. **価値の維持・通貨代替機能**: 高残価価値（AAPL, エルメス, フェラーリ）、通貨代替（マルボロ, ディアジオ）
4. **ブランドキーパーソンの経営層取り込み**: デザイン・ブランド責任者のC-suite化（コーチ/タペストリー, AAPL）
   → Y 自身の自己評価: 「外見的な評価が多く、背後要因をもとにした評価が少ない印象」

---

## 現状の課題（feedback.md + Phase 2 分析から特定）

### 課題 1: AI 推論の不安定性

- 銘柄ごとに推論パターンが大きく異なる（LLY で「考え直す」批判が続出、他銘柄では穏やか）
- STEP3 での最終出力で推論段階の批判が消えて好意的に拡大解釈される
- **根本原因**: Few-shot examples（MSFT/TSMC）の影響で AI がフォーマットを模倣しようとし、参照例に批判的な推論が発生

### 課題 2: コンテキスト理解の限界

- アナリストの意図を誤読（CDNS の技術革新: 顧客サイドの革新 vs 企業サイドの投資必要性）
- 前提知識の ① 期初レポートと ② 四半期レビューを並列評価（本来は ①主、②従）
- **Y の表現**: 「②の積み重ねから拡大解釈するのでなく、①の妥当性を再検討させるような仕組み考えられないのでしょうか？」

### 課題 3: CAGR パラメータの一貫性

- LLY では確度と寄与を分離、CHD では確度を寄与に取り込む → 一貫性なし
- 数値の根拠が不透明（+1-2% の背景不明）
- **Y の方針**: 「優位性と CAGR 下支えの評価は独立して行い、優位性が100%あるものとして、CAGR接続への納得度評価とする」

### 課題 4: 既存判断の無批判的受容

- Y が最も欲しいのは「既存判断への警鐘」だが、AI は受容・拡大解釈する傾向
- **Y の表現**: 「FMやANが既存判断に縛られて、当初の合理性を欠いていることへの警鐘的機能ほしいです」

### 課題 5: AI が結果を原因に取り違える

- Phase 2 で Y が繰り返し指摘: 「シェアは結果であって原因ではない」「ポートシフトは結果、管理力が優位性」
- AI はアナリストレポートから「競争優位性らしき部分を抽出して競争優位としている」（COST 全体印象）

### 課題 6: Y の哲学が未文書化

- K の Dogma は存在するが Y の判断軸は体系化されていない
- Y の判断パターンは Phase 2 スコアリングに暗黙的に含まれるが、明示的なルール集がない
- Y と K のフレームワークの差分が不明

---

## 改善計画

### Stage 1: Y の判断軸の抽出・文書化（最優先）

#### 1.1 Y の投資哲学ドキュメント作成

- Phase 2 全5銘柄のスコアリングパターンを横断分析
- feedback.md の各セッションから判断ルールを抽出
- K の Dogma.md フォーマットを参考に（ただし内容は Y 固有のもの）Y 版 Dogma を作成
- 作成後、Y に ○/×/△ で検証してもらうフローを設計

**具体的な抽出対象:**

- 却下（10-30%）パターンの体系化 → 「Y が優位性と認めないもの」リスト
- 高評価（70-90%）パターンの体系化 → 「Y が優位性と認める条件」リスト
- ブランド力評価フレームワーク（MNST コメントから既に4類型を抽出済み）
- 因果関係の判定基準（結果 vs 原因の区別ロジック）
- CAGR 接続の評価基準（構造的 vs 補完的の区別）

#### 1.2 Few-shot Examples の再設計

- Y が高評価した分析を「良い例」として選定
- Y が却下した分析を「悪い例」として選定
- AI への参照例の選択が結果を大きく左右することが判明 → 意図的にコントロール

#### 1.3 一貫性の確保

- CAGR パラメータ処理のルール統一（Y の方針: 優位性確信度とCAGR接続は独立評価）
- 推論パターンの標準化（銘柄間で一貫した推論フロー）
- 期初レポートと四半期レビューの優先順位付けロジック（①が主、②が従を明示的にプロンプトに組み込み）

### Stage 2: Critique Agent の構築（短期）

#### 2.1 Y の視点で批判を行う Critique Agent

- Stage 1 で作成した Y の判断軸をシステムプロンプトに組み込み
- Phase 2 の既存データを入力 → Y のスコアをどれだけ再現できるかで検証
- 「これはメガファーマなら誰でも持っている」「これは優位性ではなく戦略だ」等の批判を自動生成
- **検証方法**: 5銘柄の Phase 2 スコアとの相関で精度を測定

#### 2.2 アナリストごとのフレームワーク切替

- K の Dogma → K モード、Y の判断軸 → Y モード
- 将来の拡張性を考慮したモジュラー設計
- 各アナリストの判断軸ファイルを `analyst/Competitive_Advantage/analyst_{name}/dogma.md` に配置

### Stage 3: マルチエージェント化（中期）

#### 3.1 弁証法的アーキテクチャ

```
FM Agent (Y's Philosophy)
├── Bull Agent（買いの根拠を徹底的に探す）
├── Bear Agent（売りの根拠を徹底的に探す）
├── Competitive Advantage Critic（Y の判断軸に基づく批判）
├── CAGR Validator（数値の根拠と一貫性を検証）
├── Causality Checker（結果 vs 原因の区別を強制）
├── Historical Analogy Agent（Y の過去判断事例との整合性チェック）
└── Bias Detector（確認バイアス・初期判断への固執を検出）
```

#### 3.2 Bias Detector Agent（Y が最も望む機能）

- 初期投資判断（①期初レポート）と四半期レビュー（②）の乖離を検出
- アナリストが無意識に変更した前提を特定
- 「当初の判断はまだ合理的か？」を定期的に問う
- ②の積み重ねからの拡大解釈を検出・警告

#### 3.3 Causality Checker（新規追加）

- AI が「結果」を「原因」として提示する問題を構造的に解決
- 「高シェア → 優位性」ではなく「何が → 高シェアをもたらしたか」を強制
- Y の却下パターンをルールベースでチェック

### Stage 4: 完全 AI 運用チーム（長期）

- リサーチから銘柄選定、ポートフォリオ構築まで
- 既存の market/analyze/factor/strategy パッケージとの統合
- リアルタイム市場データとの連携

---

## 即座に着手すべきアクション

### Action 1: Y の判断パターン横断分析レポート【完了】

**出力先**: `analyst/Competitive_Advantage/analyst_YK/judgment_patterns.md`

**実装内容:** 全5銘柄34項目の優位性スコア + 36項目のCAGR接続スコアを横断分析。12の判断ルール、7つの却下パターン、5つの高評価パターン、ブランド力評価4類型を抽出。

### Action 2: Y 版 Dogma 作成【完了】

| ファイル | 用途 |
|----------|------|
| `analyst/Competitive_Advantage/analyst_YK/dogma_draft.md` | Y への検証用（○/×/△ チェックリスト + 追加質問 Q1-Q6） |
| `analyst/Competitive_Advantage/analyst_YK/dogma.md` | 運用版（Critique Agent のシステムプロンプト参照用） |

### Action 3: Critique Agent プロトタイプ【完了】

- **エージェント定義**: `.claude/agents/competitive-advantage-critique.md`
- Dogma を読み込み、Phase 1 出力に対して Phase 2 形式の批評を生成
- 既存 Phase 2 データとの照合による精度検証モードを内蔵
- 目標: Y のスコアとの平均乖離 ±10% 以内

### Action 4: Critique Agent 検証【次のステップ】

- CHD または MNST の Phase 1 相当データを入力として Critique Agent を実行
- AI 生成スコアと Y の実スコアの乖離分析レポートを出力
- 乖離が大きい項目の原因分析 → Dogma の改善ポイント特定
- 検証結果を Y への Dogma 検証依頼と合わせて提示

---

## 議論ログ

### Session 1（2026-02-06）

**Phase 1: 抽象的な設計議論**

- データ少量問題 → LLM の既存知識 + Y の「レンズ」装着
- Y の結論中心問題 → 低コスト検証ループ
- A vs B → レイヤードアプローチ（哲学 + 拡張の共存）
- エージェント構成 → 弁証法的アーキテクチャ

**Phase 2: データ分析と誤解の修正**

- `analyst/` ディレクトリの発見 → AI 分析システム（Phase 1/2）は既に存在
- 当初 `Competitive_Advantage_Dogma.md` を Y の哲学と誤認
- **重要な修正1**: Dogma.md はアナリスト K の判断軸（サンプルとして後から配置）、Y の哲学は未文書化
- **重要な修正2**: Y が批評した AI レポートは Dogma.md に基づいて生成されたものではなく、別のレポート
- Phase 2 のスコアは Y の直接判断（最も信頼度の高いデータ）

**Phase 3: Y の判断パターン深掘り分析**

- Phase 2 全5銘柄（CHD, COST, LLY, MNST, ORLY）を横断分析
- Y の却下パターン（10-30%）7類型を特定
- Y の高評価パターン（70-90%）6類型を特定
- Y のブランド力評価フレームワーク（4類型）を MNST コメントから抽出
- **課題の再定義**: 6つの課題を特定（推論不安定性、コンテキスト理解、CAGR一貫性、無批判的受容、結果vs原因の混同、Y哲学未文書化）
- **即座のアクション**: ① Y の判断パターン横断分析 → ② Y 版 Dogma ドラフト → ③ Critique Agent プロトタイプ

### Session 2（2026-02-09）

**環境情報:** 会社の Dify 環境で同様の競争優位性評価ワークフローを並行構築中。Claude Code 側の Dogma / Agent 設計は Dify ワークフローの設計資産としても活用される。

**Phase 4: Dogma 清書版作成 + Critique Agent 構築**

- プランファイルを `docs/plan/` → `analyst/` に移動（プロジェクト関連ファイルの集約）
- `dogma_draft.md`（検証用）と `dogma.md`（運用版）を分離
  - 運用版: ○/×/△ を除去し、LLM が参照しやすい構造に清書
  - 7セクション構成: 基本哲学 / 評価体系 / CAGR接続基準 / ブランド評価 / 情報ソース優先順位 / 12判断ルール / スコア分布参考値
- Critique Agent（`competitive-advantage-critique`）を `.claude/agents/` に作成
  - 5ステップ処理: Dogma読込 → 入力読込 → 各仮説批評 → スコア決定 → 警鐘機能
  - Phase 2 形式の出力テーブル + 検証モード内蔵
- **次のステップ**: Action 4（CHD or MNST での検証実行）
